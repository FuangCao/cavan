#!/bin/bash

function read_select()
{
	echo $1
	shift

	select SELECT in $*
	do
		[ "${SELECT}" ] && break
	done
}

function file_abs_directory()
{
	cd $(dirname $1) && pwd
}

CMD_ABS_DIR=$(file_abs_directory $0)
CAVAN_ABS_PATH=$(dirname ${CMD_ABS_DIR})

if [ "$1" ]
then
TARGET_MAKEFILE=$1
else
TARGET_MAKEFILE="${CAVAN_ABS_PATH}/Makefile"
fi

read_select "Target Arch" host arm x86
ARCH=${SELECT}
read_select "Toolchian prefix" none arm-linux- arm-cavan-linux-gnueabi- arm-none-linux-gnueabi-
CROSS_COMPILE=${SELECT}
read_select "Build type" debug release static
BUILD_TYPE=${SELECT}
read_select "Build Entry" app lib cavan
BUILD_ENTRY=${SELECT}

[ "${CROSS_COMPILE}" = "none" ] && CROSS_COMPILE=""

echo "Generation ${TARGET_MAKEFILE}"

cat > ${TARGET_MAKEFILE} << EOF
ARCH = ${ARCH}
CROSS_COMPILE = ${CROSS_COMPILE}
BUILD_TYPE = ${BUILD_TYPE}
BUILD_ENTRY = ${BUILD_ENTRY}
CFLAGS =
LDFLAGS =
Q = @

include build/core/main2.mk
EOF
